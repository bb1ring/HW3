p8105_hw3_SL5454
================
2024-10-10

## Problem 1

``` r
library(p8105.datasets)
data("ny_noaa")
```

Dataset description: This dataset shows some of the weather data in New
York, including the date of collection, maximum and minimum temperature,
total daily precipitation, snowfall, and snow depth. The structure of
the dataset includes rows for each date of collection, with columns for
each of the weather measurements. The dataset spans the period from
January 1981 through December 2010 and contains approximately 2.6
million records. When attempting to predict trends in these
measurements, missing values in precipitation, snowfall, and snow depth
may affect the results of the analysis.

``` r
summary(ny_noaa)
```

    ##       id                 date                 prcp               snow       
    ##  Length:2595176     Min.   :1981-01-01   Min.   :    0.00   Min.   :  -13   
    ##  Class :character   1st Qu.:1988-11-29   1st Qu.:    0.00   1st Qu.:    0   
    ##  Mode  :character   Median :1997-01-21   Median :    0.00   Median :    0   
    ##                     Mean   :1997-01-01   Mean   :   29.82   Mean   :    5   
    ##                     3rd Qu.:2005-09-01   3rd Qu.:   23.00   3rd Qu.:    0   
    ##                     Max.   :2010-12-31   Max.   :22860.00   Max.   :10160   
    ##                                          NA's   :145838     NA's   :381221  
    ##       snwd            tmax               tmin          
    ##  Min.   :   0.0   Length:2595176     Length:2595176    
    ##  1st Qu.:   0.0   Class :character   Class :character  
    ##  Median :   0.0   Mode  :character   Mode  :character  
    ##  Mean   :  37.3                                        
    ##  3rd Qu.:   0.0                                        
    ##  Max.   :9195.0                                        
    ##  NA's   :591786

``` r
ny_weather = ny_noaa |>
  janitor::clean_names() |>
  separate(date, into = c("year", "month", "day"), sep = "-") |>
  mutate(
    year = as.numeric(year),
    month = as.numeric(month),
    day = as.numeric(day),
    tmax = as.numeric(tmax),
    tmin = as.numeric(tmin),
    tmin_celsius = tmin / 10,
    tmax_celsius = tmax / 10,
    prcp_mm = prcp / 10)

ny_weather |>
  count(snow) |>
  arrange(desc(n)) |>
  head(n = 3)
```

    ## # A tibble: 3 × 2
    ##    snow       n
    ##   <int>   <int>
    ## 1     0 2008508
    ## 2    NA  381221
    ## 3    25   31022

The most common observed value is 0, because many days likely have no
snowfall.

The two-panel plot showing the average max temperature in January and in
July in each station across years.

``` r
ny_weather |>
  filter(month == c("1", "7")) |>
  group_by(id, year, month) |>
  summarise(avg_tmax = mean(tmax_celsius, na.rm = TRUE)) |>
  ungroup() |>
  ggplot(aes(x = year, y = avg_tmax)) +
  geom_point() +
  facet_wrap(~ month) +
  labs(title = "Average Max Temperature in January and July",
       x = "Month", y = "Average Max Temperature (C)") 
```

    ## `summarise()` has grouped output by 'id', 'year'. You can override using the
    ## `.groups` argument.

    ## Warning: Removed 5972 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

![](p8105_hw3_SL5454_files/figure-gfm/unnamed-chunk-3-1.png)<!-- --> In
Janurary 2004, there were 2 outliers, showing an unusual high maximum
temperature. In July 1988, there were 1 outlier, showing an usual low
maximum temperature. The average maximum temperature in July didn’t
change much across the year. On the contrary, the maximum temperature in
Janurary went up and down across years.

1)  tmax vs tmin for the full dataset

``` r
ny_weather |>
  filter(!is.na(tmin) & !is.na(tmax)) |>
  ggplot(aes(x = tmin, y = tmax)) +
  geom_hex() +
  labs(title = "Max Temperature vs Min Temperature",
    x = "Min Temperature (C)", y = "Max Temperature (C)") +
  theme_minimal()
```

![](p8105_hw3_SL5454_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->
(ii) The distribution of snowfall values greater than 0 and less than
100 separately by year

``` r
ny_weather|>
  filter(snow > '0' & snow < '100') |>
  ggplot(aes(x = year, y = snow)) + 
  geom_violin(alpha = 0.3) +
  labs(title = "Distribution of Snowfall Values (0, 100) by Year",
       y = "Snowfall", x = "Years") 
```

![](p8105_hw3_SL5454_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

## Problem 2

``` r
accelv = read_csv(file = "./data/nhanes_accel.csv",
                  na = c("NA", "", ".")) |>
  janitor::clean_names()
```

    ## Rows: 250 Columns: 1441
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (1441): SEQN, min1, min2, min3, min4, min5, min6, min7, min8, min9, min1...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
demo = read_csv(
  file = "./data/nhanes_covar.csv",
  na = c("NA", "", "."), 
  skip = 4) |>
  janitor::clean_names() |>
  filter(age >= '21' & !is.na(education) & !is.na(bmi))
```

    ## Rows: 250 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (5): SEQN, sex, age, BMI, education
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
all_data = 
  left_join(demo, accelv, by = "seqn") |>
  mutate(sex = factor(sex, levels = c(1, 2), labels = c("Male", "Female")),
         education = factor(education, levels = 1:3, labels = c("Less than High School", 
                                                                "High School Equivalent", 
                                                                "More than High School"))) 
```

The table for sex distribution in each education category, and the graph
for age distribution in each education category.

``` r
all_data |>
  group_by(sex, education) |>
  summarize(count = n()) |>
  ungroup() |>
  pivot_wider(
    names_from = 'sex',
    values_from = 'count'
  ) |>
  knitr::kable()
```

    ## `summarise()` has grouped output by 'sex'. You can override using the `.groups`
    ## argument.

| education              | Male | Female |
|:-----------------------|-----:|-------:|
| Less than High School  |   27 |     28 |
| High School Equivalent |   35 |     23 |
| More than High School  |   56 |     59 |

``` r
all_data|>
  ggplot(aes(x = sex, y = age)) +
  geom_boxplot() +
  facet_wrap(~education) +
  labs(
    title =  "Age Distribution for Men and Women in Education",
    x = "Sex",
    y = "Age"
  )
```

![](p8105_hw3_SL5454_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->
Almost half of the women and men received education more than high
school. Those people usually has a smaller median age comparing to other
groups. There are more men than women in the group with high school
equivalent education. In addition, in this group, men tend to be
educated at a younger age than women.

Graph: Total activity vs age by sex and education level

``` r
data_clean = all_data |>
  pivot_longer(
    cols = min1:min1440,
    names_to = "min",
    names_prefix = "min", 
    values_to = "activity"
  ) |>
  mutate(min = as.numeric(min))

data_clean |>
  group_by(seqn, age, sex, education) |>
  summarise(total_activity = sum(activity, na.rm = TRUE)) |>
  ungroup() |>
  ggplot(aes(x = age, y = total_activity, color = sex)) +
  geom_point() +                 
  geom_smooth() + 
  facet_wrap(~ education) +                  
  labs(title = "Total Activity and Age Trend by Sex and Education Level",
       x = "Age",
       y = "Total Activity") +
  theme_minimal()
```

    ## `summarise()` has grouped output by 'seqn', 'age', 'sex'. You can override
    ## using the `.groups` argument.
    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

![](p8105_hw3_SL5454_files/figure-gfm/unnamed-chunk-8-1.png)<!-- --> In
general, the total value of activity is greater for women than for men
at all ages with high school equivalent and more than high school
education. In less than high school education group, men have more total
activity than women after ago of 40.

Accelerometer data allows the inspection activity over the course of the
day. Make a three-panel plot that shows the 24-hour activity time
courses for each education level and use color to indicate sex. Describe
in words any patterns or conclusions you can make based on this graph;
including smooth trends may help identify differences.

``` r
data_clean |>
  mutate(hour = min / 60) |>
  group_by(sex, education, hour) |>
  summarize(mean_activity = mean(activity, na.rm = TRUE)) |>
  ggplot(aes(x = hour, y = mean_activity, color = sex)) +
  geom_point(alpha = 0.3) +
  geom_smooth() +
  facet_wrap(~ education, nrow = 3) +
  labs(title = "24-Hour Activity Time Course by Education and Sex",
       x = "Time of Day (hours)", y = "Mean Activity") 
```

    ## `summarise()` has grouped output by 'sex', 'education'. You can override using
    ## the `.groups` argument.
    ## `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'

![](p8105_hw3_SL5454_files/figure-gfm/unnamed-chunk-9-1.png)<!-- -->
Most people’s activity levels increase dramatically from 5am to 10am.
Across all levels of education, women are typically more active than men
in the middle of the day.
